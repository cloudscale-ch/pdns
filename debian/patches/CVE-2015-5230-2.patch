From 8c91e2ccd0c775405b3c3dc0cb576106924ae364 Mon Sep 17 00:00:00 2001
From: Peter van Dijk <peter.van.dijk@netherlabs.nl>
Date: Mon, 24 Aug 2015 16:42:32 +0200
Subject: [PATCH] plug memleak

---
 pdns/distributor.hh | 4 ++++
 1 file changed, 4 insertions(+)

diff --git a/pdns/distributor.hh b/pdns/distributor.hh
index f958ff3..c6b3ae6 100644
--- a/pdns/distributor.hh
+++ b/pdns/distributor.hh
@@ -265,9 +265,11 @@ template<class Answer, class Question, class Backend>void *MultiThreadDistributo
       catch(std::exception& e)
       {
         L<<Logger::Error<<"Error in callback (while sending reply): "<<e.what()<<endl;
+        delete AD.A;
       }
       catch(...) {
         L<<Logger::Error<<"Unknown callback (sending reply) error"<<endl;
+        delete AD.A;
       }
     }
     
@@ -314,9 +316,11 @@ template<class Answer, class Question, class Backend>int SingleThreadDistributor
   catch(std::exception& e)
   {
     L<<Logger::Error<<"Error in callback (while sending reply): "<<e.what()<<endl;
+    delete AD.A;
   }
   catch(...) {
     L<<Logger::Error<<"Unknown callback (sending reply) error"<<endl;
+    delete AD.A;
   }
   return 0;
 }
