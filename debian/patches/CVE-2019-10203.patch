From 6b48327a0da913d8eeb1c1a4938d3f22d80f9fb3 Mon Sep 17 00:00:00 2001
From: Peter van Dijk <peter.van.dijk@powerdns.com>
Date: Tue, 30 Jul 2019 15:40:09 +0200
Subject: [PATCH] adjust gpgsql schema for advisory 2019-06

---
 modules/gpgsqlbackend/4.1.10_to_4.1.11.schema.pgsql.sql | 1 +
 modules/gpgsqlbackend/schema.pgsql.sql                  | 2 +-
 2 files changed, 2 insertions(+), 1 deletion(-)
 create mode 100644 modules/gpgsqlbackend/4.1.10_to_4.1.11.schema.pgsql.sql

diff --git a/modules/gpgsqlbackend/4.1.10_to_4.1.11.schema.pgsql.sql b/modules/gpgsqlbackend/4.1.10_to_4.1.11.schema.pgsql.sql
new file mode 100644
index 0000000000..b0c2ee1efa
--- /dev/null
+++ b/modules/gpgsqlbackend/4.1.10_to_4.1.11.schema.pgsql.sql
@@ -0,0 +1 @@
+ALTER TABLE domains ALTER notified_serial TYPE bigint USING CASE WHEN notified_serial >= 0 THEN notified_serial::bigint END;
diff --git a/modules/gpgsqlbackend/schema.pgsql.sql b/modules/gpgsqlbackend/schema.pgsql.sql
index b105d87951..cad35d5f19 100644
--- a/modules/gpgsqlbackend/schema.pgsql.sql
+++ b/modules/gpgsqlbackend/schema.pgsql.sql
@@ -4,7 +4,7 @@ CREATE TABLE domains (
   master                VARCHAR(128) DEFAULT NULL,
   last_check            INT DEFAULT NULL,
   type                  VARCHAR(6) NOT NULL,
-  notified_serial       INT DEFAULT NULL,
+  notified_serial       BIGINT DEFAULT NULL,
   account               VARCHAR(40) DEFAULT NULL,
   CONSTRAINT c_lowercase_name CHECK (((name)::TEXT = LOWER((name)::TEXT)))
 );


From 15b1f3607691e6b0443696d6edca40cc3a04bbb0 Mon Sep 17 00:00:00 2001
From: tcely <tcely@users.noreply.github.com>
Date: Sun, 4 Aug 2019 05:12:30 -0400
Subject: [PATCH] gpgsqlbackend: add missing schema file to Makefile

---
 modules/gpgsqlbackend/Makefile.am | 1 +
 1 file changed, 1 insertion(+)

diff --git a/modules/gpgsqlbackend/Makefile.am b/modules/gpgsqlbackend/Makefile.am
index 8a820d516b..9e2f271702 100644
--- a/modules/gpgsqlbackend/Makefile.am
+++ b/modules/gpgsqlbackend/Makefile.am
@@ -12,6 +12,7 @@ dist_doc_DATA = \
 	schema.pgsql.sql \
 	nodnssec-3.x_to_3.4.0_schema.pgsql.sql \
 	dnssec-3.x_to_3.4.0_schema.pgsql.sql \
+	4.1.10_to_4.1.11.schema.pgsql.sql \
 	3.4.0_to_4.1.0_schema.pgsql.sql
 
 libgpgsqlbackend_la_SOURCES = \
